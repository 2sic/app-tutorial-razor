@inherits Custom.Hybrid.Razor14
@using ToSic.Razor.Blade;
@using System.Linq;
<hide>
  @* Sys must always be an exact copy of this line, so that we could search/replace *@
  @{ var Sys = CreateInstance("../shared/Helpers.cs").Init(this); }
  @Html.Partial("_header.cshtml", new { Sys = Sys }) 
  @{  var fancybox = CreateInstance("../shared/Fancybox.cs");}
</hide>


<trim>
<div class="row">
  <div class="col-lg-7">
    <h2>Example from CSV which was uploaded as an App Setting</h2>
    <p>
      This is similar to the previous example, except that the CSV file 
      can be uploaded again and again in the App-Settings UI. So the path isn't hard-coded.  
      <br>
    </p>
    @fancybox.PreviewWithLightbox(App.Path + "/data/assets/query-products-csv.png", 400, 200)
  </div>
  @Html.Partial("../shared/_DefaultInfoSection.cshtml")
</div>
</trim>

@Sys.SourceCode.ResultAndSnippetStart("data-csv-query-settings", "Source-code products.csv.txt")
  @{
    // get the query
    var query = App.Query["ProductsFromCsvInAppSettings"];

    // get the data from the query
    var products = AsList(query);

    // get the current author (if available) from the stream Current
    var current = AsList(query["Current"]).FirstOrDefault();
  }
  <ul>
    @foreach(var product in products) {
      <!-- this li will have class=selected if it's the current one -->
      <li class='@(product == current ? "selected" : "")'>
        <!-- this creates a link to the current tutorial (data220) and product=id -->
        <a href='@Link.To(parameters: "data231=true&product=" + product.EntityId)'>
          @product.Name (#@product.Id)
        </a>
        @if(current == product) {
          <br>
          <em>
            @current.Description 
            (<a href="@product.Link" target="_blank">find out more</a>)
          </em>
        }
      </li>
    }
  </ul>
@Sys.SourceCode.ResultEnd("file:assets/products.csv.txt")


@Sys.PageParts.FooterWithSource()