@inherits Custom.Hybrid.Razor14
<hide>
@Html.Partial("_header.cshtml")
@*
// TODO: doesn't work in Oqtane
*@
@{
  var hlp = CreateInstance("../shared/Helpers.cs");
}
</hide>
@using System.Configuration
@using System.Data
@using System.Data.SqlClient

<trim>
<div class="row">
  <div class="col-lg-7">
    <h2>The top 10 files found in this portal as returned from DB</h2>
    <p>
      This example queries the DNN SQL for the files using a <code>DataTable</code> object.
    </p>
  </div>
  @Html.Partial("../shared/_DefaultInfoSection.cshtml")
</div>

</trim>
<snippet id="sql-datatable">
@{
  // load the sql connection name from Web.Config
  // the default connection string for DNN is SiteSqlServer
  var conString = ConfigurationManager.ConnectionStrings["SiteSqlServer"].ToString();

  // You should always write parameters using the @-syntaxt,
  // and never write them directly into the SQL using string-concatenation
  // to protect yourself from SQL injection attacks
  const string sqlCommand = "Select Top 10 * from Files Where PortalId = @PortalId";

  // create an adapter object, tell it what to do, and load results into fileTable
  var adapter = new SqlDataAdapter(sqlCommand, conString);
  adapter.SelectCommand.Parameters.AddWithValue("@PortalId", CmsContext.Site.Id);
  var fileTable = new DataTable();
  adapter.Fill(fileTable);
}
</snippet>
<hide-silent> @* Show only this snippet *@
  @Html.Partial("../shared/_source-code.cshtml", new { Path, Snippet = "sql-datatable", Size = 350 }) 
</hide-silent>
<snippet id="sql-rows">
<ol>
  @foreach (DataRow row in fileTable.Rows)
  {
    <li>@row["FileName"]</li>
  }
</ol>
</snippet>
<hide-silent> @* Show only this snippet *@
  @Html.Partial("../shared/_source-code.cshtml", new { Path, Snippet = "sql-rows", Size = 150 }) 
</hide-silent>


<trim>
<h2>The top 10 files found in this portal with reverse sorting</h2>
</trim>
<snippet id="sql-reverse">
@{
  // This applies a default-view with more parameters
  fileTable.DefaultView.Sort = "FileName DESC";
}
<ol>
  @foreach (DataRow row in fileTable.DefaultView.ToTable().Rows)
  {
    <li>@row["FileName"]</li>
  }
</ol>
</snippet>
<hide-silent> @* Show only this snippet *@
  @Html.Partial("../shared/_source-code.cshtml", new { Path, Snippet = "sql-reverse", Size = 250 }) 
</hide-silent>

<hide>
@Html.Partial("../shared/_PreCodeFooter.cshtml")
@Html.Partial("../shared/_source-code.cshtml", new { Path, Size = 1100 }) 
</hide>