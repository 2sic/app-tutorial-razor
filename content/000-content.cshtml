@inherits Custom.Hybrid.RazorTyped
@using ToSic.Razor.Blade;
@using System.Linq;
<hide>
  @* Sys must always be an exact copy of this line, so that we could search/replace *@
  @{ var Sys = GetCode("../shared/Helpers.cs").Init(this); }
  @Html.Partial("header.cshtml", new { Sys = Sys })
</hide>


<div @Sys.PageParts.InfoWrapper()>
  @Html.Partial("../shared/DefaultInfoSection.cshtml")
  <div @Sys.PageParts.InfoIntro()>
    <h2>Working with Content</h2>
    <p>In most cases a template will run in a context - so something prepared data for the template, which should now be visualized. These examples assume you're working with 2sxc, which let's editors work with content - and your template only needs to visualize it. The current content item (if it's just one) is always available on the variable called <code>Content</code>. It's a <code>dynamic</code> object, so you can just type things like <code>@@Content.FirstName</code> to access the properties.</p>
  </div>
</div>

<hide>
@{
  // Patch so the tutorial works reliably even if the main module had data added which are not a person
  // So we're simulating that `MyItem` is a person, even if in the tutorial setup it may not be
  var MyItem = AsItem(MyData);
  var MyItems = AsItems(MyData);
}
</hide>

<h3>Show Content of the Current template</h3>

@Sys.SourceCode.ResultAndSnippetStart("demo1", "R14")
  @MyItem.Picture("Mugshot", settings: "Square", width: 100, imgClass: "rounded-circle")
  <ul>
    <li>Name: @MyItem.String("FirstName") @MyItem.String("LastName")</li>
    <li>Birthday: @MyItem.DateTime("Birthday").ToString("d")</li>
    <li>Award: @MyItem.Child("Awards").String("Name")</li>
  </ul>
@Sys.SourceCode.ResultEnd("snippet:*-14")

@* Snippet for the old v14 code, which shouldn't run but should be shown. This is a bit of a hack, but it works
@Sys.SourceCode.SnippetStart("demo1-14")
  @Kit.Image.Img(Content.Field("Mugshot"), settings: "Square", width: 100, imgClass: "rounded-circle")
  <ul>
    <li>Name: @Content.FirstName @Content.LastName</li>
    <li>Birthday: @Content.Birthday.ToString("d")</li>
    <li>Award: @Content.Awards.Name</li>
  </ul>
@Sys.SourceCode.SnippetEnd()
*@

<trim>
<p>In this example, the Content-Item is of the type <code>Person</code>. It has properties like <code>Name, Birthday</code> etc. and a property called <code>Awards</code>. <code>Awards</code> refers to other items of the type <code>PersonAwards</code> and has properties like <code>Name</code>. The above example showed the award Name using <code>@@Content.Awards.Name</code> - which makes sense when you only expect one award. Below we'll show some ways to show many items, if there are more than one.  
</trim>

<trim>

<h3>Show all Items assigned to current template</h3>
  <p>
    If a view has many items assigned (called a list) these should be retrieved from <code>Data</code> - if you don't specify a stream, it's treated as <code>Data["Default"]</code>. You will usually want to convert it to a dynamic list using <code>AsList(...)</code>. This example also uses <code>Text.Has(...)</code> to only show a picture if it really has a mugshot. 
  </p>
</trim>

@Sys.SourceCode.ResultAndSnippetStart("demo2", "R14")
  <ul>
    @foreach (var person in MyItems) {
      <li>
        @person.Picture("Mugshot", settings: "Square", width: 50, imgClass: "rounded-circle")
        @person.String("FirstName") @person.String("LastName")
      </li>
    }
  </ul>
@Sys.SourceCode.ResultEnd("snippet:*-14")

@* Snippet for the old v14 code, which shouldn't run but should be shown. This is a bit of a hack, but it works
@Sys.SourceCode.SnippetStart("demo2-14")
  <ul>
  @foreach (var person in AsList(Data)) {
    <li>
      @if (Text.Has(person.Mugshot)) {
        @Kit.Image.Img(Content.Field("Mugshot"), settings: "Square", width: 50, imgClass: "rounded-circle")
      }
      @person.FirstName @person.LastName
    </li>
  }
  </ul>
@Sys.SourceCode.SnippetEnd()
*@

<trim>
<h3>Show sub-items of current items</h3>

  <p>
    This example builds on the last one, and additionally shows awards these authors have won, which is on the <code>Awards</code> property.
  </p>
</trim>

@Sys.SourceCode.ResultAndSnippetStart("demo3", "R14")
  <ul>
    @foreach (var person in MyItems) {
      <li>
        @person.Picture("Mugshot", settings: "Square", width: 50, imgClass: "rounded-circle")
        @person.String("FirstName") @person.String("LastName")
        @if (person.Children("Awards").Any()) {
          // we just want the award names - to understand this, look at the LINQ tutorial
          var awardNames = person.Children("Awards").Select(a => a.String("Name"));
          <span>
            (awards: @string.Join(",", awardNames))
          </span>
        }
      </li>
    }
  </ul>
@Sys.SourceCode.ResultEnd("snippet:*-14")

@* Snippet for the old v14 code, which shouldn't run but should be shown. This is a bit of a hack, but it works
@Sys.SourceCode.SnippetStart("demo3-14")
  <ul>
    @foreach (var person in AsList(Data)) {
      <li>
        @if (Text.Has(person.Mugshot)) {
          <img loading="lazy" src="@person.Mugshot?w=50&h=50&mode=crop" width="50px" style="border-radius: 50%">
        }
        @person.FirstName @person.LastName
        @if (person.Awards.Count > 0 ) {
          // we just want the award names - to understand this, look at the LINQ tutorial
          var awardNames = AsList(person.Awards as object).Select(a => a.Name);
          <span>
            (awards: @string.Join(",", awardNames))
          </span>
        }
      </li>
    }
  </ul>
@Sys.SourceCode.SnippetEnd()
*@

@* Footer *@
@Html.Partial("../Shared/Layout/FooterWithSource.cshtml", new { Sys = Sys })