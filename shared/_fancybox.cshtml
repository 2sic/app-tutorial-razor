@inherits ToSic.Custom.Razor12
@using ToSic.Razor.Blade;
@functions {
  // Create an image which opens a larger version in a lighbox
  public dynamic PreviewWithLightbox(string url, int width = 100, int height = 100, 
    string classes = "",
    string label = null)
  {
    return Html.Raw(
      AddFancyBoxOnce()
      + Tag.Figure(
          Tag.A().Attr("data-fancybox='gallery'").Href(url).Class(classes).Attr("data-caption", label).Wrap(
            Tag.Img().Src(url + "?w=" + width + "&h=" + height)
          )
        )
    );
  }

  // this value will be used to ensure we only add the scripts once
  private bool initialized = false;

  // Make sure the fancybox is added to the page, but only once
  string AddFancyBoxOnce() {
    if(initialized) { return null; }
    initialized = true;
    return 
      "<link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css' />"
      + "<script src='https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js'></script>"
    ;
  }

}