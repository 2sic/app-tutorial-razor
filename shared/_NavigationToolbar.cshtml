@inherits Custom.Hybrid.Razor12
@using System.Linq;
@using ToSic.Sxc.Services;
@{
  var hlp = CreateInstance("Helpers.cs");
  var currentView = CmsContext.View;
  var viewMdType = hlp.TutViewMetadataType as string;

  // Enable Fa5 for icons
  var page = GetService<IPageService>();  // Service to set titles etc. on the page
  page.Activate("FontAwesome5");
  
  // Fallback for missing metadata
  var unknownViewMetadata = AsDynamic(new {
    LinkTitle = "Todo",
  });

  // Get current datasets
  var viewMd = AsDynamic((currentView.Metadata.OfType(viewMdType) as IEnumerable<dynamic>).FirstOrDefault() ?? unknownViewMetadata);
  var tutorialSection = AsDynamic(AsList(
    App.Data["TutorialSection"])
      .Where(section => (section.Views as IEnumerable<dynamic>)
      .Any(view => view.EntityId == currentView.Id)
    ).FirstOrDefault());

  var viewList = (tutorialSection.Views as IEnumerable<dynamic>).ToList();
  var currentIndex = viewList.FindIndex(view => view.EntityId == currentView.Id);
  var previousTutorial = currentIndex > 0 ? viewList[currentIndex - 1] : null;
  var nextTutorial = currentIndex < viewList.Count() - 1 ? viewList[currentIndex + 1] : null;
  var homeTarget ="#" + tutorialSection.NameId;
}

<div class="alert alert-dark container-fluid">
  <div class="row justify-content-between">
    <div class="col-4">
      @{
        var previousTutorialMd = previousTutorial != null ? AsDynamic((previousTutorial.Metadata.OfType(viewMdType) as IEnumerable<dynamic>).FirstOrDefault() ?? unknownViewMetadata) : null;
        var previousTutorialTarget = previousTutorialMd != null ? hlp.GetTargetUrl(previousTutorial.ViewNameInUrl.Replace("/.*", "")) : homeTarget;
      }

      <a href="@Link.To(parameters: previousTutorialTarget)">
        <i class="fas fa-chevron-left"></i>
        @(previousTutorial != null ? Html.Raw(previousTutorialMd.LinkTitle.Replace("<p>", "").Replace("</p>", "")) : "Home")
      </a>
    </div>
    <div class="col-4 text-center">
      <strong>#@(currentIndex + 1) @Html.Raw(viewMd.LinkTitle.Replace("<p>", "").Replace("</p>", "")) </strong>
    </div>
    <div class="col-4 text-end">
      @{
        var nextTutorialMd = nextTutorial != null ? AsDynamic((nextTutorial.Metadata.OfType(viewMdType) as IEnumerable<dynamic>).FirstOrDefault() ?? unknownViewMetadata) : null;
        var nextTutorialTarget = nextTutorialMd != null ? hlp.GetTargetUrl(nextTutorial.ViewNameInUrl.Replace("/.*", "")) : homeTarget;
      }

      <a href="@Link.To(parameters: nextTutorialTarget)">
        @(nextTutorial != null ? Html.Raw(nextTutorialMd.LinkTitle.Replace("<p>", "").Replace("</p>", "")) : "Home")
        <i class="fas fa-chevron-right"></i>
      </a>
    </div>
  </div>
</div>
<hr>