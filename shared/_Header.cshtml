@inherits Custom.Hybrid.Razor12
@using System.Linq;
@using ToSic.Sxc.Services;
@using ToSic.Razor.Blade;
@{
  var hlp = CreateInstance("../shared/Helpers.cs");
  var title = DynamicModel.Title;
  var name = DynamicModel.Name;
  var topicHomeLink = DynamicModel.Link;

  // Page Metadata - will create a toolbar for this
  var viewMdType = hlp.TutViewMetadataType as string;
  var md = CmsContext.View.Metadata;

  // Metadata with new toolbar services
  var tlbSvc = GetService<IToolbarService>();
  var newConfig = tlbSvc
    .Metadata(CmsContext.View, viewMdType)
    .Metadata(CmsContext.View, "TutorialViewSharing")
    .Settings(hover: "left");

  @* Adding Metadata for Opengraph sharing *@

  var viewSharingMdType = hlp.TutViewSharingMetadataType as string;
  var viewMd = AsList(md.OfType(viewMdType) as object).FirstOrDefault();
  var sharingMd = AsList(md.OfType(viewSharingMdType) as object).FirstOrDefault();

  @* meta variables *@
  var metaTitle = sharingMd != null ? Tags.Strip(sharingMd.Title) : Tags.Strip(viewMd.LinkTitle);
  var metaDescription = sharingMd != null ? Tags.Strip(sharingMd.Description) : Tags.Strip(viewMd.LinkTeaser);
  var metaImageUrl = sharingMd != null ? sharingMd.Image != "" ? Link.Image(sharingMd.Image, height: 630, width: 1200, type: "full") : "" : "";
  var metaUrlTarget = Link.To(parameters: CmsContext.Page.Parameters);

  var page = GetService<IPageService>();

  // Add open graph meta information
  page.AddOpenGraph("og:type", "article");
  page.AddOpenGraph("og:title", metaTitle);
  page.AddOpenGraph("og:site_name", metaTitle);
  page.AddOpenGraph("og:url", metaUrlTarget);
  page.AddOpenGraph("og:description", metaDescription);
  page.AddOpenGraph("og:image", metaImageUrl);
  page.AddOpenGraph("og:image:height", "630");
  page.AddOpenGraph("og:image:width", "1200");

  // Add twitter meta information
  page.AddMeta("twitter:card", "summary_large_image");
  page.AddMeta("twitter:title", metaTitle);
  page.AddMeta("twitter:description", metaDescription);
  page.AddMeta("twitter:image", metaImageUrl);
}

<script type="text/javascript" src="@Settings.AddThisJS"></script>
<div @Edit.TagToolbar(newConfig) class="mb-2">
  @if (DynamicModel.FeatureIconPath != null) {
    @hlp.AddFeatureLogo(DynamicModel.FeatureIconPath, DynamicModel.FeatureLink)
  }
  @hlp.TitleAndBreadcrumb(title, name, topicHomeLink)
</div>