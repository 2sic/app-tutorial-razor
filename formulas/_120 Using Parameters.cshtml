@inherits Custom.Hybrid.Razor14
@using ToSic.Razor.Blade;
<hide>
  @* Sys must always be an exact copy of this line, so that we could search/replace *@
  @{ var Sys = CreateInstance("../shared/Helpers.cs").Init(this); }
  @Html.Partial("_header.cshtml", new { Sys = Sys })
</hide>


<div @Sys.PageParts.InfoWrapper()>
  @Html.Partial("../shared/_DefaultInfoSection.cshtml")
  <div @Sys.PageParts.InfoIntro()>
    <h2>Formulas using parameters</h2>
    <p>We'll show you how to use page parameters with formulas</p>
    <p>In this tutorial you'll learn how to:</p>
    <ul>
      <li>
        Use emphemeral fields
      </li>
      <li>
        Use <code>data.parameters</code> in your formulas <em>new in v14</em>
      </li>
    </ul>
    @Html.Partial("./Part NowUsingV2.cshtml")
  </div>
</div>
@Html.Partial("../shared/_WarnAnonymousIfFeatureIsOff.cshtml")

<h3>Ephemeral fields explained</h3>
<p>Sometimes you need fields which controle the Form UI without being real data. Some examples:</p>
<ul>
  <li>Toggles which show/hide other fields or field groups</li>
  <li>Hidden calculations which will consolidate other field values to determine if something else is required</li>
</ul>

<p>We don't want to save these fields as the data is not relevant, and often the value should be calculated upon opening
  the form - so it's important that they are reset.</p>

<h3>Create an Ephemeral field</h3>
<p>An Ephemeral field is just a normal field with an additional configuration.</p>
<h4>Configure an Epemeral field</h4>
<p>To configure a field to not save and be temporary / ephemeral, use this setting:</p>
@Sys.Fancybox.PreviewWithLightbox(App.Path + "/formulas/images/ephemeral.jpg", 300, 200)
<p>Learn more about Ephemeral fields <a href="https://docs.2sxc.org/basics/data/fields/ephemeral.html">here</a>.</p>



<h3>Ephemeral field </h3>
@{
  var specs = Sys.SourceCode.Formulas.Specs("parameters-ephemeral");
}
@Sys.SourceCode.FormulaStart("formulas-ephemeral", specs)
  Button which doesn't tell the form anything:
  @Kit.Toolbar.Empty().New("FormulasEphemeral", ui: Sys.SourceCode.Formulas.Icon()).AsTag()
  <br>
  Button which will tell the form to show advanced:
  @Kit.Toolbar.Empty().New("FormulasEphemeral",
    ui: Sys.SourceCode.Formulas.Icon(),
    prefill:"VarShowAdvanced=true"
  ).AsTag()
@Sys.SourceCode.Invisible()
<p>
  <code>VarShowAdvanced</code> is an ephemeral field and thus not saved in the database. 
  This formula determines the visibility of the Advanced Settings group. 
  The group becomes visible, when the VarShowAdvanced toggle is active.
  <br>
  <em>Click on the (Σ) button above to see the edit-UI with the formula. </em>
</p>
@Sys.SourceCode.FormulaEnd()



<h3>Configure edit form UI using parameters</h3>
<p>
  In 2sxc v14 we added <code>data.parameters.*</code> which contains all parameters given in the prefill.
</p>
<p>
  By passing parameters directly, edit forms can be configured without the need of additional Ephemeral fields. This
  enables a editing experience matching the page context.
</p>

@{
  specs = Sys.SourceCode.Formulas.Specs("parameters-basic");
}

@Sys.SourceCode.FormulaStart("formulas-showAdvanced", specs)
  <code>prefill:showAdvanced=true</code>:
  @Kit.Toolbar.Empty().New("FormulasParameters",
    ui: Sys.SourceCode.Formulas.Icon(),
    prefill: "showAdvanced=true"
  ).AsTag()
  <br>
  <code>prefill:showAdvanced=false</code>:
  @Kit.Toolbar.Empty().New("FormulasParameters",
    ui: Sys.SourceCode.Formulas.Icon(),
    prefill: "showAdvanced=false"
  ).AsTag()
@Sys.SourceCode.Invisible()
  <p>
    <code>showAdvanced</code> is a parameter, that was passed with the toolbar prefill.
    This formula determines the visibility of the Advanced Settings group.
    The group becomes visible, when the passed <code>showAdvanced</code> parameter is true.
    <br>
    <em>Click on the (Σ) button above to see the edit-UI with the formula based on the passed prefill parameter. </em>
  </p>
@Sys.SourceCode.FormulaEnd()




@Sys.SourceCode.FormulaShow("parameters-basic")



@Sys.PageParts.FooterWithSource()
