@inherits Custom.Hybrid.Razor14
<hide>
  @{
  // Tell the page that we need the 2sxc Js APIs
  Kit.Page.Activate("2sxc.JsCore"); 
  }
  @* Sys must always be an exact copy of this line, so that we could search/replace *@
  @{ var Sys = CreateInstance("../shared/Helpers.cs").Init(this); }
  @Html.Partial("_header.cshtml", new { Sys = Sys })
  @{
      string sourceCode = Sys.ShowCodeFile; // must be typed, because Html.Partial on Oqtane can't use dynamic variables
  }
</hide>

<trim>
  <div class="row mb-5">
    <div class="col-lg-7">
      <h2>App.Data WebApi Examples</h2>
      <p>In this example, we'll get app-data from the WebApi.</p>

      <p>Click to see the result of a WebApi call with the shared code:</p>
    </div>
    @Html.Partial("../shared/_DefaultInfoSection.cshtml")
  </div>
</trim>


@Sys.SourceCode.ResultAndSnippetStart("demo-1", "Source of api_BooksController")
  <button type="button" class="btn btn-primary" onclick="getPersons(this)">
    Get Persons Custom
  </button> 
  <button type="button" class="btn btn-primary" onclick="getBooks(this)">
    Get Books Custom
  </button> 
  <button type="button" class="btn btn-primary" onclick="getPersonsAuto(this)">
    Get Persons with Auto-Convert
  </button> 
  <script>
    function getPersons(moduleContext) {
      $2sxc(moduleContext).webApi.fetchJson('books/persons')
        .then(function(data) {
          alert('Found ' + data.length + ' persons. \n'
            + 'The first one is "' + data[0].FirstName + ' ' + data[0].LastName + '"\n\n'
            + 'The raw JSON: \n' + JSON.stringify(data)
          );
        });
    }
    function getBooks(moduleContext) {
      $2sxc(moduleContext).webApi.fetchJson('books/books')
        .then(function(results) {
          alert('Found ' + results.length + ' books. \n'
            + 'The first one is "' + results[0].Title + '"\n\n'
            + 'The raw JSON: \n' + JSON.stringify(results)
            );
        });
    }
    function getPersonsAuto(moduleContext) {
      $2sxc(moduleContext).webApi.fetchJson('books/personsAuto')
        .then(function(results) {
          alert('On WebApi with Auto-Convert: Found ' + results.length + ' persons. \n'
            + 'The first one is "' + results[0].FirstName + ' ' + results[0].LastName + '"\n\n'
            + 'The raw JSON: \n' + JSON.stringify(results)
          );
        });
    }
  </script>
@Sys.SourceCode.ResultEnd("file:../api/BooksController.cs")


@Sys.PageParts.FooterWithSource()