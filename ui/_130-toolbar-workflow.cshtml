@inherits Custom.Hybrid.Razor12
<hide>
@Html.Partial("_header.cshtml")

<h2>2sxc UI - Toolbar Workflows</h2>
<p>
  Toolbars will automatically do things like open a dialog or refresh the page when the dialog closes. 
  But sometimes you want to override or change the default behavior - like:
</p>
<ol>
  <li>Prevent refresh on dialog close - to retrieve the data in JS</li>
  <li>Prevent creating new if a specific condition applies</li>
</ol>
<p>
  This is what the Workflows are for. You can register custom <code>before</code> and <code>after</code> code to run, change specs or prevent the action from executing. 
  <a href="https://r.2sxc.org/js-workflow" target="_blank">Read the workflow docs</a> or the 
  <a href="https://docs.2sxc.org/how-to/customize-edit-ux/toolbars.html" target="_blank">toolbar docs</a> to learn more about this. 
</p>

<div class="alert alert-warning">
  Important: Usually only editors see these toolbars - so saving won't work. 
  Hover over the various boxes to see the result - like this: <br>
  <img loading="lazy" src="@App.Path/ui/assets/hover-example.jpg" width="100%">
</div>

<hr>
</hide>

<h2>Simple Setup, Single Toolbar</h2>

<div class="alert alert-primary" style="width: 50%;">
  <div id='tagWithToolbar1' @Edit.TagToolbar(toolbar: new [] { "toolbar=empty", "+new?contentType=UiEmptyHelloWorld" })>
    Float over this box to get a (+) button. 
    When you click it and close the dialog again, the page will <em>not refresh</em>. <br>
    Instead, you'll see console messages that a custom JS took over the process.
  </div>
</div>

<script>
  // Attach event-listener to the parent, so we can register the workflow when the toolbar is created
  var parent = document.getElementById('tagWithToolbar1');
  parent.addEventListener('toolbar-init', (initEvent) => {
    console.log("Workflow Demo: Toolbar was initialized - event kicked in - will now register");
    const workflow = initEvent.detail.workflow;

    // This workflow step will run on every action, just to log what's happening
    const workflowToLog = {
      command: 'all',   // Run on every command/action
      phase: 'all',     // Run before and after
      code: (wfArgs) => {
        console.log("Toolbar asked to to something - here are the details.", wfArgs);
      }
    }

    // This is the workflow step we will register to stop page refresh
    const workflowToDisableRefresh = {
      command: 'refresh',   // The command name it's for
      phase: 'before',      // The workflow-step should run before the command is executed
      code: (wfArgs) => {   // The code which should be run
        console.log('Toolbar asked to refresh, will return false to stop it. These are the arguments we got.', wfArgs);
        return false;       // Return false to stop this command from happening
      }
    };

    workflow.add(workflowToLog);
    workflow.add(workflowToDisableRefresh);

    // Stop the event here, otherwise parent elements which have an event listener would get triggered as well
    initEvent.stopPropagation();
  });
</script>

<hide>
  <hr>
  <h2>More Stuff</h2>
  <div>
    You can do much more - like change icons, call call-parameters etc. 
    Read the 
    <a href="https://docs.2sxc.org/how-to/customize-edit-ux/toolbars.html" target="_blank">how-to</a> and the 
    <a href="https://docs.2sxc.org/specs/cms/toolbars/toolbar-builder.html" target="_blank">specs</a> for this.
  </div>
</hide>
<hide>
@Html.Partial("../shared/_source-code.cshtml", new { Path }) 
@* 2sxclint:disable:no-inline-script *@

@{
  // Special command to ensure that the toolbars appear, even if they are won't work.
  // This is not an official API, and may change any time.
  // This will tell the edit-UI that it's enabled (which is usually only the case if a user is an editor)
  Edit.Enabled = true;

  // This will tell the edit-UI that we need the JS features
  Edit.Enable(api: true, context: true, styles: true);
}
</hide>